{% extends "wrapped/base.html" %}

{% block content %}
<h1>Your Spotify Wrapped</h1>
<a href="{% url 'spotify_logout' %}" class="btn btn-danger">Log Out</a>

<div class="slide-container">
    <!-- Slide 1: Welcome Slide -->
    <div class="slide" id="slide-1">
        <h2>{{ slides.0.title }}</h2>
        <p>{{ slides.0.content }}</p>
        <button onclick="showSlide(2);">Next</button>
    </div>

    <!-- Slide 2: Your Top Tracks -->
    <div class="slide" id="slide-2" style="display:none;">
        <h2>{{ slides.1.title }}</h2>
        <ul>
          {% for track in slides.1.items %}
            <li>
              {% if track.album.images.0.url %}
                <img src="{{ track.album.images.0.url }}" alt="{{ track.name }}" width="50">
              {% endif %}
              {{ track.name }} by {{ track.artists|join:", " }}
            </li>
          {% endfor %}
        </ul>
        <button onclick="showSlide(1);">Previous</button>
        <button onclick="showSlide(3);">Next</button>
    </div>

    <!-- Slide 3: Track Popularity -->
    <div class="slide" id="slide-3" style="display:none;">
        <h2>{{ slides.2.title }}</h2>
        <ul>
          {% for track in slides.2.items %}
            <li>
              {% if track.image %}
                <img src="{{ track.image }}" alt="{{ track.name }}" width="50">
              {% endif %}
              {{ track.name }} - Popularity: {{ track.popularity }}
            </li>
          {% endfor %}
        </ul>
        <button onclick="showSlide(2);">Previous</button>
        <button onclick="showSlide(4);">Next</button>
    </div>

    <!-- Slide 4: Top Artists -->
    <div class="slide" id="slide-4" style="display:none;">
        <h2>{{ slides.3.title }}</h2>
        <ul>
          {% for artist in slides.3.items %}
            <li>
              {% if artist.images.0.url %}
                <img src="{{ artist.images.0.url }}" alt="{{ artist.name }}" width="50">
              {% endif %}
              {{ artist.name }}
            </li>
          {% endfor %}
        </ul>
        <button onclick="showSlide(3);">Previous</button>
        <button onclick="showSlide(5);">Next</button>
    </div>

    <!-- Slide 5: Top Genres -->
    <div class="slide" id="slide-5" style="display:none;">
        <h2>{{ slides.4.title }}</h2>
        <ul>
          {% for genre, count in slides.4.items %}
            <li>{{ genre }} ({{ count }} artists)</li>
          {% endfor %}
        </ul>
        <button onclick="showSlide(4);">Previous</button>
        <button onclick="showSlide(6);">Next</button>
    </div>

    <!-- Slide 6: Recently Played -->
    <div class="slide" id="slide-6" style="display:none;">
        <h2>{{ slides.5.title }}</h2>
        <ul>
          {% for item in slides.5.items %}
            <li>
              {% if item.track.album.images.0.url %}
                <img src="{{ item.track.album.images.0.url }}" alt="{{ item.track.name }}" width="50">
              {% endif %}
              {{ item.track.name }} by {{ item.track.artists|join:", " }}
            </li>
          {% endfor %}
        </ul>
        <button onclick="showSlide(5);">Previous</button>
        <button onclick="showSlide(7);">Next</button>
    </div>

    <!-- Slide 7: Total Time Listened -->
    <div class="slide" id="slide-7" style="display:none;">
        <h2>{{ slides.6.title }}</h2>
        <p>{{ slides.6.content }}</p>
        <button onclick="showSlide(6);">Previous</button>
        <button onclick="showSlide(8);">Next</button>
    </div>

    <!-- Slide 8: Artist Followers -->
    <div class="slide" id="slide-8" style="display:none;">
        <h2>{{ slides.7.title }}</h2>
        <ul>
          {% for artist in slides.7.items %}
            <li>
              {% if artist.image %}
                <img src="{{ artist.image }}" alt="{{ artist.name }}" width="50">
              {% endif %}
              {{ artist.name }} - Followers: {{ artist.followers }}
            </li>
          {% endfor %}
        </ul>
        <button onclick="showSlide(7);">Previous</button>
        <button onclick="showSlide(9);">Next</button>
    </div>

    <!-- closing -->
    <div class="slide" id="slide-9" style="display:none;">
        <h2>{{ slides.8.title }}</h2>
        <p>{{ slides.8.content }}</p>
        <button onclick="showSlide(8);">Previous</button>

        <!-- social -->
        <div class="social-share">
            <h3>Share Your Wrapped:</h3>
             <a href="{% url 'shareable_page' wrapped_id=wrapped_id %}" target="_blank" class="btn btn-share">View and Share Link</a>
        </div>
    </div>
</div>

<script>
    function showSlide(slideNumber) {
        const slides = document.querySelectorAll(".slide");
        slides.forEach(slide => slide.style.display = "none");
        document.getElementById(`slide-${slideNumber}`).style.display = "block";
    }

    // Show the first slide initially
    showSlide(1);

    // sharing
    const pageTitle = "My Spotify Wrapped";
    const pageURL = window.location.href;  // Current page URL

</script>
{% endblock %}
