{% extends "wrapped/base.html" %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-spotify-black to-spotify-dark">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-4xl font-bold text-white">Your Spotify Wrapped</h1>
        </div>

        <!-- Slides Container -->
        <div class="relative min-h-[600px] bg-spotify-card rounded-xl shadow-2xl p-8">
            <!-- Slide 1: Welcome -->
            <div class="slide absolute inset-0 p-8 transition-opacity duration-500" id="slide-1">
                <div class="h-full flex flex-col justify-center items-center text-center">
                    <h2 class="text-5xl font-bold text-spotify-green mb-6">{{ slides.0.title }}</h2>
                    <p class="text-2xl text-white mb-8">{{ slides.0.content }}</p>
                    <button onclick="showSlide(2);"
                            class="animate-bounce bg-spotify-green hover:bg-spotify-green-dark text-white px-8 py-3 rounded-full text-xl transition duration-300">
                        Let's Go!
                    </button>
                </div>
            </div>

            <!-- Slide 2: Top Tracks -->
            <div class="slide hidden absolute inset-0 p-8" id="slide-2">
                <h2 class="text-4xl font-bold text-spotify-green mb-6">{{ slides.1.title }}</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {% for track in slides.1.items %}
                    <div class="flex items-center bg-spotify-dark-card rounded-lg p-4 hover:bg-spotify-hover transition duration-300">
                        {% if track.album.images.0.url %}
                        <img src="{{ track.album.images.0.url }}"
                             alt="{{ track.name }}"
                             class="w-20 h-20 rounded-md shadow-lg">
                        {% endif %}
                        <div class="ml-4">
                            <h3 class="text-white font-semibold">{{ track.name }}</h3>
                            <p class="text-gray-400">{{ track.artists.0.name }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="flex justify-between mt-8">
                    <button onclick="showSlide(1);" class="slide-nav-btn">Previous</button>
                    <button onclick="showSlide(3);" class="slide-nav-btn">Next</button>
                </div>
            </div>

            <!-- Slide 3: Top Artists -->
            <div class="slide hidden absolute inset-0 p-8" id="slide-3">
                <h2 class="text-4xl font-bold text-spotify-green mb-6">{{ slides.2.title }}</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {% for artist in slides.2.items %}
                    <div class="flex items-center bg-spotify-dark-card rounded-lg p-4 hover:bg-spotify-hover transition duration-300">
                        {% if artist.images.0.url %}
                        <img src="{{ artist.images.0.url }}"
                             alt="{{ artist.name }}"
                             class="w-20 h-20 rounded-md shadow-lg">
                        {% endif %}
                        <div class="ml-4">
                            <h3 class="text-white font-semibold">{{ artist.name }}</h3>
                            <p class="text-gray-400">Top Tracks:</p>
                            <ul class="text-gray-400 text-sm">
                                {% for track in artist.top_tracks %}
                                <li>- {{ track.name }}</li>
                                {% endfor %}
                            </ul>
                            <p class="text-gray-400 mt-2">Listening Time: {{ artist.listening_time.hours }} hrs {{ artist.listening_time.minutes }} mins</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="flex justify-between mt-8">
                    <button onclick="showSlide(2);" class="slide-nav-btn">Previous</button>
                    <button onclick="showSlide(4);" class="slide-nav-btn">Next</button>
                </div>
            </div>

            <!-- Slide 4: Recently Played -->
            <div class="slide hidden absolute inset-0 p-8" id="slide-4">
                <h2 class="text-4xl font-bold text-spotify-green mb-6">{{ slides.3.title }}</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {% for track in slides.3.items %}
                    <div class="flex items-center bg-spotify-dark-card rounded-lg p-4 hover:bg-spotify-hover transition duration-300">
                        {% if track.track.album.images.0.url %}
                        <img src="{{ track.track.album.images.0.url }}"
                             alt="{{ track.track.name }}"
                             class="w-20 h-20 rounded-md shadow-lg">
                        {% endif %}
                        <div class="ml-4">
                            <h3 class="text-white font-semibold">{{ track.track.name }}</h3>
                            <p class="text-gray-400">{{ track.track.artists.0.name }}</p>
                            <p class="text-gray-400 text-sm">{{ track.played_at|date:"Y-m-d H:i" }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="flex justify-between mt-8">
                    <button onclick="showSlide(3);" class="slide-nav-btn">Previous</button>
                    <button onclick="showSlide(5);" class="slide-nav-btn">Next</button>
                </div>
            </div>

            <!-- Slide 5: Top Genres -->
            <div class="slide hidden absolute inset-0 p-8" id="slide-5">
                <h2 class="text-4xl font-bold text-spotify-green mb-6">{{ slides.4.title }}</h2>
                <ul class="text-white text-lg">
                    {% for genre, count in slides.4.items %}
                    <li class="mb-4">
                        <span class="text-spotify-green font-semibold">{{ genre }}</span>: {{ count }} artists
                    </li>
                    {% endfor %}
                </ul>
                <div class="flex justify-between mt-8">
                    <button onclick="showSlide(4);" class="slide-nav-btn">Previous</button>
                    <button onclick="showSlide(6);" class="slide-nav-btn">Next</button>
                </div>
            </div>

            <!-- Slide 6: Track Popularity -->
            <div class="slide hidden absolute inset-0 p-8" id="slide-6">
                <h2 class="text-4xl font-bold text-spotify-green mb-6">{{ slides.5.title }}</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {% for track in slides.5.items %}
                    <div class="flex items-center bg-spotify-dark-card rounded-lg p-4 hover:bg-spotify-hover transition duration-300">
                        {% if track.image %}
                        <img src="{{ track.image }}"
                             alt="{{ track.name }}"
                             class="w-20 h-20 rounded-md shadow-lg">
                        {% endif %}
                        <div class="ml-4">
                            <h3 class="text-white font-semibold">{{ track.name }}</h3>
                            <p class="text-gray-400">Popularity: {{ track.popularity }}%</p>
                            {% if track.preview_url %}
                            <audio controls class="mt-2">
                                <source src="{{ track.preview_url }}" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="flex justify-between mt-8">
                    <button onclick="showSlide(5);" class="slide-nav-btn">Previous</button>
                    <button onclick="showSlide(7);" class="slide-nav-btn">Next</button>
                </div>
            </div>

            <!-- Slide 7: Artist Followers -->
            <div class="slide hidden absolute inset-0 p-8" id="slide-7">
                <h2 class="text-4xl font-bold text-spotify-green mb-6">{{ slides.6.title }}</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {% for artist in slides.6.items %}
                    <div class="flex items-center bg-spotify-dark-card rounded-lg p-4 hover:bg-spotify-hover transition duration-300">
                        {% if artist.image %}
                        <img src="{{ artist.image }}"
                             alt="{{ artist.name }}"
                             class="w-20 h-20 rounded-md shadow-lg">
                        {% endif %}
                        <div class="ml-4">
                            <h3 class="text-white font-semibold">{{ artist.name }}</h3>
                            <p class="text-gray-400">Followers: {{ artist.followers}}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="flex justify-between mt-8">
                    <button onclick="showSlide(6);" class="slide-nav-btn">Previous</button>
                    <button onclick="showSlide(8);" class="slide-nav-btn">Next</button>
                </div>
            </div>

            <!-- Slide 8: Total Time Listened -->
            <div class="slide hidden absolute inset-0 p-8" id="slide-8">
                <h2 class="text-4xl font-bold text-spotify-green mb-6">{{ slides.7.title }}</h2>
                <p class="text-2xl text-white">{{ slides.7.content }}</p>
                <div class="flex justify-between mt-8">
                    <button onclick="showSlide(7);" class="slide-nav-btn">Previous</button>
                    <button onclick="showSlide(9);" class="slide-nav-btn">Next</button>
                </div>
            </div>

            <!-- Final Slide -->
<div class="slide hidden absolute inset-0 p-8" id="slide-9">
    <div class="h-full flex flex-col justify-center items-center text-center">
        <h2 class="text-5xl font-bold text-spotify-green mb-6">{{ slides.8.title }}</h2>
        <p class="text-2xl text-white mb-8">{{ slides.8.content }}</p>

        <div class="save-wrap mt-8">
            <h3 class="text-xl text-white mb-4">Do you want to save your Wrapped?</h3>
            <form method="POST" action="{% url 'user_dashboard' %}">
                {% csrf_token %}
                <label for="custom_name" class="block text-lg text-white mb-2">Enter a name for your Wrapped here!:</label>
                <input
                    type="text"
                    id="custom_name"
                    name="custom_name"
                    class="px-4 py-2 w-64 rounded-md text-gray-900"
                    placeholder="e.g., My 2024 Wrapped"
                    required>

                <button type="submit"
                        class="mt-4 bg-spotify-green hover:bg-spotify-green-dark text-white px-8 py-3 rounded-full transition duration-300">
                    Save
                </button>
            </form>
        </div>



<div class="social-share mt-8">
    <h3 class="text-xl text-white mb-4">And share your Wrapped:</h3>
    <div class="flex justify-center space-x-8">
        <!-- Instagram -->
        <a href="https://www.instagram.com/accounts/login/" target="_blank" onclick="downloadAndRedirect(this.href); return false;" class="text-white hover:text-spotify-green transition duration-300">
            <i class="fab fa-instagram text-5xl"></i>
        </a>
        <!-- Twitter -->
        <a href="https://twitter.com/login" target="_blank" onclick="downloadAndRedirect(this.href); return false;" class="text-white hover:text-spotify-green transition duration-300">
            <i class="fab fa-twitter text-5xl"></i>
        </a>
        <!-- LinkedIn -->
        <a href="https://www.linkedin.com/login/" target="_blank" onclick="downloadAndRedirect(this.href); return false;" class="text-white hover:text-spotify-green transition duration-300">
            <i class="fab fa-linkedin text-5xl"></i>
        </a>
    </div>
</div>







                    <button onclick="showSlide(8);"
                            class="mt-8 text-gray-400 hover:text-white transition duration-300">
                        ‚Üê Back
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .social-share a {
    display: inline-block;
    line-height: 0;
    }

    .social-share a:hover {
    transform: scale(1.1);
}
    .slide {
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s ease-in-out;
    }
    .slide.active {
        opacity: 1;
        pointer-events: auto;
    }
    .slide-nav-btn {
        @apply bg-spotify-green hover:bg-spotify-green-dark text-white px-6 py-2 rounded-full transition duration-300;
    }
</style>

<script>
function showSlide(slideNumber) {
    const slides = document.querySelectorAll(".slide");
    slides.forEach(slide => {
        slide.classList.remove('active');
        slide.style.display = 'none';
        setTimeout(() => {
            if (slide.id === `slide-${slideNumber}`) {
                slide.style.display = 'block';
                setTimeout(() => slide.classList.add('active'), 50);
            }
        }, 500);
    });
}

// Show first slide on load
document.addEventListener('DOMContentLoaded', () => {
    showSlide(1);
});




</script>

<script>
function downloadAndRedirect(url) {
    fetch('{% url "download_wrapped_image" %}')
        .then(response => response.blob())
        .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'spotify_wrapped.png';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
        })
        .catch(error => console.error('Download failed:', error))
        .finally(() => {
            window.location.href = url;
        });
}
</script>
{% endblock %}